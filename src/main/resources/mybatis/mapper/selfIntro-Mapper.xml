<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.cdp.sint.service.impl.SelfIntroMapper">
<!-- 리스트 조회 쿼리 -->
<select id="selectSelfIntroQList" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroQVO" resultType="kr.or.ddit.cdp.sint.service.SelfIntroQVO">
    SELECT * FROM (
        SELECT ROWNUM AS RNUM, B.*
        FROM (
            SELECT SIQ_ID, SIQ_JOB, SIQ_CONTENT
            FROM SELF_INTRO_Q
            <where>
                <if test="keyword != null and keyword != ''">
                    AND SIQ_CONTENT LIKE '%' || #{keyword} || '%'
                </if>
                <if test="siqJobFilter != null and siqJobFilter != ''">
                    AND SIQ_JOB = #{siqJobFilter}
                </if>
            </where>
            ORDER BY SIQ_ID 
        ) B
        WHERE ROWNUM &lt;= #{endRow}
    )
    WHERE RNUM &gt;= #{startRow}
</select>

<!-- 갯수 조회 하기  -->
<select id="selectSelfIntroQCount" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroQVO" resultType="int">
    SELECT COUNT(*)
    FROM SELF_INTRO_Q
    <where>
        <if test="keyword != null and keyword != ''">
            AND SIQ_CONTENT LIKE '%' || #{keyword} || '%'
        </if>
        <if test="siqJobFilter != null and siqJobFilter != ''">
            AND SIQ_JOB = #{siqJobFilter}
        </if>
    </where>
</select>

<!-- 자소서 직종 공통코드 가져오기 -->
<select id="selectSelfIntroComCodeList" resultType="kr.or.ddit.com.ComCodeVO">
	SELECT CC_ID, CL_CODE, CC_NAME
	FROM COM_CODE
	WHERE CL_CODE ='G36'
	ORDER BY 1
</select>

<select id="selectMaxIntroId" resultType="int">
	SELECT NVL(MAX(SI_ID),0)+1 FROM SELF_INTRO
</select>

<!-- 카트 선택한 질문들 자소서 작성에 띄워주기 위해 저장 -->
<insert id="insertIntro" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroVO">

	INSERT INTO SELF_INTRO(SI_ID, MEM_ID, SI_STATUS)
	VALUES (#{siId},#{memId},'작성중')
</insert>


<select id="selectMaxSICId" resultType="int">
		SELECT NVL(MAX(SIC_ID),0)+1 FROM SELF_INTRO_CONTENT
</select>
<!-- 자소서 항목별 저장 -->
<insert id="insertContent" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroContentVO">

		INSERT INTO SELF_INTRO_CONTENT
		(SIC_ID,SI_ID, SIQ_ID, SIC_LIMIT, SIC_ORDER)
		VALUES
		(#{sicId},#{siId}, #{siqId}, #{sicLimit}, #{sicOrder})
</insert>
<!-- 항목별 자소서내용가져오기 -->
<select id="selectBySelfIntroContentIdList" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroVO" resultType="kr.or.ddit.cdp.sint.service.SelfIntroContentVO">
	SELECT SIC_ID, SI_ID, SIQ_ID, SIC_CONTENT,
	SIC_LIMIT, SIC_COUNT,SIC_ORDER
	FROM SELF_INTRO_CONTENT
	WHERE SI_ID = #{siId}
	ORDER
	BY SIC_ORDER
</select>
<!-- 자소서 질문 가져오기 -->
<select id="selectBySelfIntroQId" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroContentVO" resultType="kr.or.ddit.cdp.sint.service.SelfIntroQVO">
	select SIQ_ID, SIQ_JOB, SIQ_CONTENT
	from SELF_INTRO_Q
	where SIQ_ID = #{siqId}
</select>
<!-- 자소서 정보 가져오기 -->
<select id="selectBySelfIntroId" parameterType="kr.or.ddit.cdp.sint.service.SelfIntroVO" resultType="kr.or.ddit.cdp.sint.service.SelfIntroVO">
	SELECT SI_ID, MEM_ID, SI_TITLE, SI_STATUS
	FROM SELF_INTRO
	WHERE SI_ID= #{siId}
</select>

</mapper>