<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.cdp.rsm.rsm.service.impl.ResumeMapper">
	<select id="getElement" parameterType="kr.or.ddit.cdp.rsm.rsm.service.ResumeSectionVO" resultType="String">
	SELECT RS_TEMPLATE
		FROM RESUME_SECTION
		WHERE RS_ID =#{rsId}
	</select>

	<select id="selectNextResumeId" resultType="int">
    	SELECT NVL(MAX(RESUME_ID), 0) + 1 FROM RESUME
	</select>
	
	<update id="mergeIntoResume" parameterType="kr.or.ddit.cdp.rsm.rsm.service.ResumeVO">
	    MERGE INTO RESUME r
	    USING DUAL
	    ON (r.RESUME_ID = #{resumeId})
	    WHEN MATCHED THEN
	        UPDATE
	        <set>
	            <if test="resumeTitle != null">
	                r.RESUME_TITLE = #{resumeTitle},
	            </if>
	            <if test="resumeIsTemp != null">
	                r.RESUME_IS_TEMP = #{resumeIsTemp},
	            </if>
	            <if test="fileGroupId != null">
	                r.FILE_GROUP_ID = #{fileGroupId},
	            </if>
   	            <if test="resumeContent != null">
	                r.RESUME_CONTENT = #{resumeContent},
	            </if>
	            r.UPDATED_AT = SYSDATE
       		</set>
				
	    WHEN NOT MATCHED THEN
	        INSERT (RESUME_ID,MEM_ID,RESUME_TITLE,RESUME_CONTENT,RESUME_IS_TEMP,CREATED_AT,UPDATED_AT,FILE_GROUP_ID)
	        VALUES (#{resumeId},#{memId},#{resumeTitle},#{resumeContent},#{resumeIsTemp},sysdate,sysdate,#{fileGroupId} )
	</update>
	
	<select id="selectResumeByResumeId" parameterType="kr.or.ddit.cdp.rsm.rsm.service.ResumeVO" resultType="kr.or.ddit.cdp.rsm.rsm.service.ResumeVO">
		SELECT RESUME_ID,MEM_ID,RESUME_TITLE,RESUME_CONTENT,RESUME_IS_TEMP,CREATED_AT,UPDATED_AT,FILE_GROUP_ID
		FROM RESUME
		WHERE RESUME_ID = #{resumeId}
	</select>
</mapper>