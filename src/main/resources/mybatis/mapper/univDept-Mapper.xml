<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.ertds.univ.dpsrch.service.impl.UnivDeptMapper">

    <!-- ê¸°ì¡´ ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ (UnivDeptVO ê·¸ëŒ€ë¡œ ì‚¬ìš©) -->
    <select id="selectUnivDeptList" parameterType="kr.or.ddit.ertds.univ.dpsrch.service.UnivDeptVO" resultType="kr.or.ddit.ertds.univ.dpsrch.service.UnivDeptVO">
        SELECT *
        FROM (
            SELECT sub.*, ROWNUM AS RNUM
            FROM (
                SELECT
                    UD.UDD_ID
                    , COALESCE(CC1.CC_NAME, UDD_L_CLASS) AS UDD_L_CLASS
                    , COALESCE(CC2.CC_NAME, UDD_M_CLASS) AS UDD_M_CLASS
                    , UDD_SUM
                    , UDD_INTEREST
                    , UDD_PROPERTY
                    , UDD_JOB_LIST
                    , UDD_LI_LIST
                    , UDS.UDS_ADMISSION_RATE AS admissionRate
                    , UDS.UDS_EMPLOYMENT_RATE_TOTAL AS empRate
                    , CASE
                        WHEN (UDS.UDS_SALARY_0_150_RATE + UDS.UDS_SALARY_151_200_RATE + UDS.UDS_SALARY_201_250_RATE + UDS.UDS_SALARY_251_300_RATE + UDS.UDS_SALARY_301_PLUS_RATE) > 0
                        THEN ROUND(
                            (UDS.UDS_SALARY_0_150_RATE * 75 +
                             UDS.UDS_SALARY_151_200_RATE * 175.5 +
                             UDS.UDS_SALARY_201_250_RATE * 225.5 +
                             UDS.UDS_SALARY_251_300_RATE * 275.5 +
                             UDS.UDS_SALARY_301_PLUS_RATE * 375) /
                            (UDS.UDS_SALARY_0_150_RATE + UDS.UDS_SALARY_151_200_RATE + UDS.UDS_SALARY_201_250_RATE + UDS.UDS_SALARY_251_300_RATE + UDS.UDS_SALARY_301_PLUS_RATE), 0
                        )
                        ELSE NULL
                      END AS avgSalary
                FROM UNIV_DEPT_DETAIL UD
                LEFT JOIN COM_CODE CC1 ON UD.UDD_L_CLASS = CC1.CC_ID
                LEFT JOIN COM_CODE CC2 ON UD.UDD_M_CLASS = CC2.CC_ID
                INNER JOIN UNIV_DEPT_STAT UDS ON UD.UDD_ID = UDS.UDD_ID
                <where>
                    <if test="keyword != null and keyword != ''">
                        AND COALESCE(CC2.CC_NAME, UD.UDD_M_CLASS) LIKE '%' || #{keyword} || '%'
                    </if>
                    <if test="lClassIds != null and lClassIds.size() > 0">
                        AND (
                        <foreach collection="lClassIds" item="id" separator="OR">
                            UD.UDD_L_CLASS = #{id}
                        </foreach>
                        )
                    </if>
                </where>
                ORDER BY UD.UDD_ID
            ) sub
            WHERE ROWNUM <![CDATA[<=]]> #{endNo}
        )
        WHERE RNUM <![CDATA[>]]> #{startNo}
    </select>

    <!-- ðŸ†• ìƒˆë¡œ ì¶”ê°€: í•™ê³¼ ìƒì„¸ ì •ë³´ ì¡°íšŒ -->
    <select id="selectDeptDetail" parameterType="int" resultType="kr.or.ddit.ertds.univ.dpsrch.service.UnivDeptDetailVO">
        SELECT 
            <!-- ê¸°ë³¸ ì •ë³´ (UNIV_DEPT_DETAILì—ì„œ) -->
            UD.UDD_ID as uddId,
            COALESCE(CC1.CC_NAME, UD.UDD_L_CLASS) as uddLClass,
            COALESCE(CC2.CC_NAME, UD.UDD_M_CLASS) as uddMClass,
            UD.UDD_SUM as uddSum,
            UD.UDD_INTEREST as uddInterest,
            UD.UDD_PROPERTY as uddProperty,
            UD.UDD_JOB_LIST as uddJobList,
            UD.UDD_LI_LIST as uddLiList,
            
            <!-- í†µê³„ ì •ë³´ ID -->
            US.UDS_ID as udsId,
            
            <!-- ì§€ì›ìž ë° ìž…í•™ ê´€ë ¨ -->
            US.UDS_TOTAL_APPLICANTS as udsTotalApplicants,
            US.UDS_TOTAL_ADMITTED as udsTotalAdmitted,
            US.UDS_MALE_ADMISSION_RATE as udsMaleAdmissionRate,
            US.UDS_FEMALE_ADMISSION_RATE as udsFemaleAdmissionRate,
            US.UDS_ADMISSION_RATE as udsAdmissionRate,
            
            <!-- ì·¨ì—…ë¥  ê´€ë ¨ -->
            US.UDS_EMPLOYMENT_RATE_TOTAL as udsEmploymentRateTotal,
            US.UDS_EMPLOYMENT_RATE_MALE as udsEmploymentRateMale,
            US.UDS_EMPLOYMENT_RATE_FEMALE as udsEmploymentRateFemale,
            
            <!-- ê¸‰ì—¬ ë¶„í¬ ê´€ë ¨ -->
            US.UDS_SALARY_0_150_RATE as udsSalary0150Rate,
            US.UDS_SALARY_151_200_RATE as udsSalary151200Rate,
            US.UDS_SALARY_201_250_RATE as udsSalary201250Rate,
            US.UDS_SALARY_251_300_RATE as udsSalary251300Rate,
            US.UDS_SALARY_301_PLUS_RATE as udsSalary301PlusRate,
            
            <!-- ì·¨ì—… ë¶„ì•¼ ê´€ë ¨ -->
            US.UDS_FIELD_CONSTRUCTION_RATE as udsFieldConstructionRate,
            US.UDS_FIELD_MANAGEMENT_RATE as udsFieldManagementRate,
            US.UDS_FIELD_EDUCATION_RATE as udsFieldEducationRate,
            US.UDS_FIELD_BEAUTY_RATE as udsFieldBeautyRate,
            US.UDS_FIELD_WELFARE_RATE as udsFieldWelfareRate,
            US.UDS_FIELD_RESEARCH_RATE as udsFieldResearchRate,
            US.UDS_FIELD_TRANSPORT_RATE as udsFieldTransportRate,
            US.UDS_FIELD_ART_RATE as udsFieldArtRate,
            US.UDS_FIELD_PRODUCT_RATE as udsFieldProductRate,
            US.UDS_FIELD_FARMER_RATE as udsFieldFarmerRate,
            
            <!-- ë§Œì¡±ë„ ê´€ë ¨ -->
            US.UDS_SATISFACTION_VERY_DISSATISFIED as udsSatisfactionVeryDissatisfied,
            US.UDS_SATISFACTION_DISSATISFIED as udsSatisfactionDissatisfied,
            US.UDS_SATISFACTION_NEUTRAL as udsSatisfactionNeutral,
            US.UDS_SATISFACTION_SATISFIED as udsSatisfactionSatisfied,
            US.UDS_SATISFACTION_VERY_SATISFIED as udsSatisfactionVerySatisfied
            
        FROM UNIV_DEPT_DETAIL UD
        LEFT JOIN COM_CODE CC1 ON UD.UDD_L_CLASS = CC1.CC_ID
        LEFT JOIN COM_CODE CC2 ON UD.UDD_M_CLASS = CC2.CC_ID
        LEFT JOIN UNIV_DEPT_STAT US ON UD.UDD_ID = US.UDD_ID
        WHERE UD.UDD_ID = #{uddId}
    </select>

    <!-- ê¸°ì¡´ ì´ ê°œìˆ˜ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="selectUniversityTotalCount" resultType="int" parameterType="kr.or.ddit.ertds.univ.uvsrch.service.UniversityVO">
        SELECT COUNT(*)
        FROM UNIV_DEPT_DETAIL UD
        LEFT JOIN COM_CODE CC2 ON UD.UDD_M_CLASS = CC2.CC_ID
        <where>
            <if test="keyword != null and keyword != ''">
                AND COALESCE(CC2.CC_NAME, UD.UDD_M_CLASS) LIKE '%' || #{keyword} || '%'
            </if>
            <if test="lClassIds != null and lClassIds.size() > 0">
                AND (
                <foreach collection="lClassIds" item="id" separator="OR">
                    UD.UDD_L_CLASS = #{id}
                </foreach>
                )
            </if>
        </where>
    </select>

    <!-- ê¸°ì¡´ ë¶ë§ˆí¬ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="selectBookMarkVO" parameterType="kr.or.ddit.mpg.mat.bmk.service.BookMarkVO" resultType="kr.or.ddit.mpg.mat.bmk.service.BookMarkVO">
        SELECT BM_ID, MEM_ID, BM_CATEGORY_ID, BM_TARGET_ID
        FROM BOOKMARK
        WHERE MEM_ID = #{memId}
        AND BM_CATEGORY_ID = #{bmCategoryId}
    </select>

    <!-- ê¸°ì¡´ ì½”ë“œ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="selectCodeVOUnivDeptLClassList" resultType="kr.or.ddit.com.ComCodeVO">
        SELECT CC_ID, CL_CODE, CC_NAME, CC_ETC
        FROM COM_CODE
        WHERE CL_CODE = 'G18'
    </select>

</mapper>